<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>View Subcategories</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100">
    <!-- Include Header -->
    <%- include('../header') %>

        <div class="flex">
            <!-- Include Sidebar -->
            <%- include('../sidebar') %>

                <!-- Main Content -->
                <div class="ml-64 flex-1 p-8">
                    <div class="max-w-3xl mx-auto w-full bg-white shadow-md rounded-lg p-8">
                        <h1 class="text-2xl font-bold text-gray-800 mb-6 text-center">Edit Book</h1>
                        <form action="/admin/editBook/<%= book._id %>" method="POST" enctype="multipart/form-data"
                            class="space-y-6">
                            <!-- Category -->
                            <div>
                                <label for="categoryId" class="block text-sm font-medium text-gray-700">Category</label>
                                <select id="categoryId" name="categoryId" required 
                                    class="block w-full mt-1 border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                                    <option value="" disabled selected>Select a category</option>
                                    <% categories.forEach(category=> { %>
                                        <option value="<%= category._id %>"
                                            <%=book.categoryId.toString()===category._id.toString() ? 'selected' : '' %>
                                            ><%= category.categoryName %>
                                        </option>
                                        <% }) %>
                                </select>
                            </div>

                            <!-- SubCategory -->
                            <div class="form-group row">
                                <label for="fname" class="col-sm-3 text-right control-label col-form-label">SubCategory
                                    Name</label>
                                <div class="col-sm-9">
                                    <select id="subCategoryId" required  name="subCategoryId">
                                        <option value="" disabled selected>------ Select Sub Category ------</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Book Title -->
                            <div>
                                <label for="bookTitle" class="block text-sm font-medium text-gray-700">Book
                                    Title</label>
                                <input type="text" id="bookTitle" name="bookTitle" value="<%= book.bookTitle %>"
                                    class="block w-full mt-1 border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                            </div>

                            <!-- Description -->
                            <div>
                                <label for="bookDescription"
                                    class="block text-sm font-medium text-gray-700">Description</label>
                                <textarea id="bookDescription" name="bookDescription" rows="4"
                                    class="block w-full mt-1 border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"><%= book.bookDescription %></textarea>
                            </div>

                            <!-- Book Image -->
                            <div>
                                <label for="bookImage" class="block text-sm font-medium text-gray-700">Book
                                    Image</label>
                                <div class="flex items-center mt-1">
                                    <img src="<%= book.bookImage %>" alt="Book Image"
                                        class="w-16 h-16 rounded-md object-cover mr-4">
                                    <input type="file" id="bookImage" name="bookImage"
                                        class="block w-full text-sm text-gray-500">
                                </div>
                            </div>

                            <!-- Pages -->
                            <div>
                                <label for="bookPages" class="block text-sm font-medium text-gray-700">Pages</label>
                                <input type="number" id="bookPages" name="bookPages" value="<%= book.bookPages %>"
                                    class="block w-full mt-1 border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                            </div>

                            <!-- Price -->
                            <div>
                                <label for="bookPrice" class="block text-sm font-medium text-gray-700">Price</label>
                                <input type="number" id="bookPrice" name="bookPrice" step="0.01"
                                    value="<%= book.bookPrice %>"
                                    class="block w-full mt-1 border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                            </div>

                            <!-- Author -->
                            <div>
                                <label for="bookAuthor" class="block text-sm font-medium text-gray-700">Author</label>
                                <input type="text" id="bookAuthor" name="bookAuthor" value="<%= book.bookAuthor %>"
                                    class="block w-full mt-1 border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                            </div>


                            <!-- Published Date -->
                            <div>
                                <label for="bookPublishedDate" class="block text-sm font-medium text-gray-700">Published
                                    Date</label>
                                <input type="date" id="bookPublishedDate" name="bookPublishedDate"
                                    value="<%= book.bookPublishedDate.toISOString().split('T')[0] %>"
                                    class="block w-full mt-1 border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                            </div>

                            <!-- Languages -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Book Language</label>
                                <div class="flex flex-wrap space-x-4">
                                    <label class="inline-flex items-center">
                                        <input type="checkbox" name="bookLanguage" value="Hindi"
                                            class="form-checkbox text-indigo-600" <% if
                                            (book.bookLanguage.includes("Hindi")) { %> checked <% } %> >
                                            <span class="ml-2">Hindi</span>
                                    </label>
                                    <label class="inline-flex items-center">
                                        <input type="checkbox" name="bookLanguage" value="English"
                                            class="form-checkbox text-indigo-600" <% if
                                            (book.bookLanguage.includes("English")) { %> checked <% } %> >
                                            <span class="ml-2">English</span>
                                    </label>
                                    <label class="inline-flex items-center">
                                        <input type="checkbox" name="bookLanguage" value="Gujarati"
                                            class="form-checkbox text-indigo-600" <% if
                                            (book.bookLanguage.includes("Gujarati")) { %> checked <% } %> >
                                            <span class="ml-2">Gujarati</span>
                                    </label>
                                    <label class="inline-flex items-center">
                                        <input type="checkbox" name="bookLanguage" value="Marathi"
                                            class="form-checkbox text-indigo-600" <% if
                                            (book.bookLanguage.includes("Marathi")) { %> checked <% } %> >
                                            <span class="ml-2">Marathi</span>
                                    </label>
                                    <label class="inline-flex items-center">
                                        <input type="checkbox" name="bookLanguage" value="Tamil"
                                            class="form-checkbox text-indigo-600" <% if
                                            (book.bookLanguage.includes("Tamil")) { %> checked <% } %> >
                                            <span class="ml-2">Tamil</span>
                                    </label>
                                    <label class="inline-flex items-center">
                                        <input type="checkbox" name="bookLanguage" value="Telugu"
                                            class="form-checkbox text-indigo-600" <% if
                                            (book.bookLanguage.includes("Telugu")) { %> checked <% } %> >
                                            <span class="ml-2">Telugu</span>
                                    </label>
                                    <label class="inline-flex items-center">
                                        <input type="checkbox" name="bookLanguage" value="Malayalam"
                                            class="form-checkbox text-indigo-600" <% if
                                            (book.bookLanguage.includes("Malayalam")) { %> checked <% } %> >
                                            <span class="ml-2">Malayalam</span>
                                    </label>
                                    <label class="inline-flex items-center">
                                        <input type="checkbox" name="bookLanguage" value="Kannada"
                                            class="form-checkbox text-indigo-600" <% if
                                            (book.bookLanguage.includes("Kannada")) { %> checked <% } %> >
                                            <span class="ml-2">Kannada</span>
                                    </label>
                                </div>
                            </div>
                            <!-- Submit Button -->
                            <div>
                                <button type="submit"
                                    class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 transition">Update
                                    Book</button>
                            </div>
                        </form>
                    </div>
                </div>

                <script>
                    document.addEventListener("DOMContentLoaded", function () {
                        const categorySelect = document.getElementById('categoryId');
                        // console.log(categorySelect);
                        const subCategorySelect = document.getElementById('subCategoryId');
                        categorySelect.addEventListener("change", function () {
                            let categoryId = categorySelect.value;
                            console.log(categoryId);
                            subCategorySelect.innerHTML = `<option disabled selected >----- Select Sub Category -----</option>`
                            // fetch(`/extraCategory/getsubcategoies?categoryId=${categoryId}`)
                            fetch(`/admin/getsubcategories/${categoryId}`)
                                .then((res) => res.json())
                                .then((data) => {
                                    // console.log(data);
                                    if (data.subCategories && data.subCategories.length > 0) {
                                        data.subCategories.forEach(subCategory => {
                                            let option = document.createElement("option");
                                            option.value = `${subCategory._id}`
                                            option.textContent = `${subCategory.subCategoryName}`
                                            subCategorySelect.appendChild(option)
                                        });
                                    } else {
                                        let option = document.createElement("option");
                                        option.value = ""
                                        option.textContent = "No Sub Category Found"
                                        subCategorySelect.appendChild(option)
                                    }
                                })
                        })

                    })
                </script>

</body>

</html>